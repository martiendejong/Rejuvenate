@model IEnumerable<Item>

@{
    ViewBag.Title = "Awareness";
}

<h2>Awareness</h2>

<div id="items">
    @foreach (var item in Model)
    {
        var id = "item" + item.Id;
        <p id="@id">
            @item.Name
        </p>
    }
</div>

<input type="button" onclick="add()" value="Add" />
<input type="button" onclick="remove()" value="Remove" />
<input type="button" onclick="update()" value="Update" />


@section  scripts
     {
    <!--Script references. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">

        var myHub;

        function add()
        {
            myHub.server.add();
        }

        function remove()
        {
            myHub.server.remove();
        }

        function update()
        {
            myHub.server.update();
        }
        
        $(function () {
            // Declare a proxy to reference the hub.
            myHub = $.connection.myHub;

            myHub.client.itemsAdded = function (type, pollerId, items)
            {
                items.forEach(function (item, index)
                {
                    var html = "<p id='item" + item.Id + "'>" + item.Name + "</p>";
                    $("#items").append(html);
                });
            }

            myHub.client.itemsRemoved = function (type, pollerId, items) {
                items.forEach(function (item, index)
                {
                    var selector = "#item" + item.Id;
                    $(selector).remove();
                });
            }

            myHub.client.itemsUpdated = function (type, pollerId, items) {
                items.forEach(function (item, index)
                {
                    var selector = "#item" + item.Id;
                    $(selector).text(item.Name);
                });
            }

            // Start the connection.
            $.connection.hub.start().done(function () {
                myHub.server.registerAwarenessClient(1);
            });
        });

    </script>

}